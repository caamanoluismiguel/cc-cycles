<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#4A90D9">
  <title>Dashboard - Classical Kids Study Hub</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo"><div class="logo-icon">ğŸ“š</div><span>Classical Kids</span></a>
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="es">ES</button>
      </div>
      <nav class="header-nav">
        <a href="index.html" class="nav-link"><span class="nav-link-icon">ğŸ </span> Home</a>
        <a href="essentials.html" class="nav-link"><span class="nav-link-icon">ğŸ“</span> Essentials</a>
        <a href="resources.html" class="nav-link"><span class="nav-link-icon">ğŸ“–</span> Resources</a>
        <a href="classical_math.html" class="nav-link"><span class="nav-link-icon">ğŸ”¢</span> Math</a>
        <a href="dashboard.html" class="nav-link active"><span class="nav-link-icon">ğŸ“Š</span> Progress</a>
        <a href="parents-guide.html" class="nav-link"><span class="nav-link-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span> Parents</a>
      </nav>
    </div>
  </header>

  <main class="main">
    <!-- Hero -->
    <div class="dashboard-hero">
      <h1>ğŸ“Š Your Progress</h1>
      <p id="welcomeMsg">Keep up the great work!</p>
    </div>
    
    <div class="container" style="margin-top: calc(var(--space-xl) * -1);">
      <!-- Stats Cards -->
      <div class="stats-cards">
        <div class="stats-card highlight">
          <div class="stats-card-icon">â±ï¸</div>
          <div class="stats-card-value" id="totalTime">0</div>
          <div class="stats-card-label">Minutes</div>
        </div>
        <div class="stats-card success">
          <div class="stats-card-icon">ğŸ“š</div>
          <div class="stats-card-value" id="totalLessons">0</div>
          <div class="stats-card-label">Lessons</div>
        </div>
        <div class="stats-card warning">
          <div class="stats-card-icon">ğŸ”¥</div>
          <div class="stats-card-value" id="dayStreak">0</div>
          <div class="stats-card-label">Day Streak</div>
        </div>
      </div>

      <!-- Calendar -->
      <div class="calendar-card">
        <h3 class="section-title">ğŸ“… Study Calendar</h3>
        <div class="calendar-grid" id="calendarGrid"></div>
      </div>

      <!-- Recent Sessions -->
      <div class="sessions-card">
        <h3 class="section-title">ğŸ“ Recent Sessions</h3>
        <div id="sessionsList"></div>
      </div>

      <!-- Achievements -->
      <div class="card card-body">
        <h3 class="section-title">ğŸ† Achievements</h3>
        <div class="achievements-grid" id="achievementsGrid"></div>
      </div>
    </div>
  </main>

  <nav class="bottom-nav">
    <div class="bottom-nav-inner">
      <a href="index.html" class="bottom-nav-item"><span class="bottom-nav-icon">ğŸ </span><span>Home</span></a>
      <a href="essentials.html" class="bottom-nav-item"><span class="bottom-nav-icon">ğŸ“</span><span>Essentials</span></a>
      <a href="classical_math.html" class="bottom-nav-item"><span class="bottom-nav-icon">ğŸ”¢</span><span>Math</span></a>
      <a href="dashboard.html" class="bottom-nav-item active"><span class="bottom-nav-icon">ğŸ“Š</span><span>Progress</span></a>
      <a href="parents-guide.html" class="bottom-nav-item"><span class="bottom-nav-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span><span>Parents</span></a>
    </div>
  </nav>

  <script>
  (function() {
    var user = localStorage.getItem('ck_user') || 'Student';
    var progress = JSON.parse(localStorage.getItem('ck_progress') || '{"sessions":[],"completed":{},"homework":[]}');
    var sessions = progress.sessions || [];
    
    document.getElementById('welcomeMsg').textContent = 'Great work, ' + user + '!';
    
    // Stats
    var totalMinutes = sessions.reduce(function(sum, s) { return sum + Math.floor((s.duration || 0) / 60); }, 0);
    var totalLessons = Object.keys(progress.completed || {}).length;
    
    var today = new Date(); today.setHours(0,0,0,0);
    var days = {};
    sessions.forEach(function(s) { var d = new Date(s.date); d.setHours(0,0,0,0); days[d.getTime()] = true; });
    var streak = 0;
    for (var i = 0; i < 30; i++) {
      if (days[today.getTime() - i * 86400000]) streak++;
      else if (i > 0) break;
    }
    
    document.getElementById('totalTime').textContent = totalMinutes;
    document.getElementById('totalLessons').textContent = totalLessons;
    document.getElementById('dayStreak').textContent = streak;
    
    // Calendar
    var cal = document.getElementById('calendarGrid');
    ['S','M','T','W','T','F','S'].forEach(function(d) {
      var el = document.createElement('div');
      el.className = 'calendar-day header'; el.textContent = d;
      cal.appendChild(el);
    });
    
    var now = new Date();
    var firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
    var daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
    
    for (var i = 0; i < firstDay.getDay(); i++) {
      var el = document.createElement('div'); el.className = 'calendar-day'; cal.appendChild(el);
    }
    
    for (var day = 1; day <= daysInMonth; day++) {
      var el = document.createElement('div');
      el.className = 'calendar-day'; el.textContent = day;
      var date = new Date(now.getFullYear(), now.getMonth(), day); date.setHours(0,0,0,0);
      if (days[date.getTime()]) el.classList.add('completed');
      if (day === now.getDate()) el.classList.add('today');
      cal.appendChild(el);
    }
    
    // Sessions
    var sessionsList = document.getElementById('sessionsList');
    var icons = {history:'ğŸ“œ',science:'ğŸ”¬',geography:'ğŸŒ',math:'ğŸ”¢',english:'ğŸ“',latin:'ğŸ“š',finearts:'ğŸ¨'};
    
    if (sessions.length === 0) {
      sessionsList.innerHTML = '<div class="text-center text-muted" style="padding: var(--space-xl);">No sessions yet. Start studying to track your progress!</div>';
    } else {
      sessionsList.innerHTML = sessions.slice(-8).reverse().map(function(s) {
        var d = new Date(s.date);
        return '<div class="session-item">' +
          '<div class="session-icon">' + (icons[s.topic] || 'ğŸ“–') + '</div>' +
          '<div class="session-info"><div class="session-title">Cycle ' + s.cycle + ' â€¢ Week ' + s.week + '</div><div class="session-date">' + d.toLocaleDateString() + '</div></div>' +
          '<div class="session-duration">' + Math.floor((s.duration||0)/60) + ' min</div></div>';
      }).join('');
    }
    
    // Achievements
    var achievements = [
      {icon:'ğŸ¯',title:'First Steps',desc:'Complete first lesson',unlocked:totalLessons>=1},
      {icon:'ğŸ“š',title:'Bookworm',desc:'Complete 10 lessons',unlocked:totalLessons>=10},
      {icon:'ğŸ”¥',title:'On Fire',desc:'3 day streak',unlocked:streak>=3},
      {icon:'â­',title:'Rising Star',desc:'7 day streak',unlocked:streak>=7},
      {icon:'ğŸ†',title:'Champion',desc:'14 day streak',unlocked:streak>=14},
      {icon:'ğŸ‘‘',title:'Scholar',desc:'30 minutes total',unlocked:totalMinutes>=30}
    ];
    
    document.getElementById('achievementsGrid').innerHTML = achievements.map(function(a) {
      return '<div class="achievement-card' + (a.unlocked ? '' : ' locked') + '">' +
        '<div class="achievement-icon">' + (a.unlocked ? a.icon : 'ğŸ”’') + '</div>' +
        '<div class="achievement-title">' + a.title + '</div>' +
        '<div class="achievement-desc">' + a.desc + '</div></div>';
    }).join('');
  })();
  </script>
</body>
</html>
