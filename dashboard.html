<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0056b3">
  <title>Dashboard - Classical Kids Study Hub</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header">
    <div class="header-container">
      <a href="index.html" class="logo"><span class="logo-emoji">ğŸ“š</span><span>Classical Kids</span></a>
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en" onclick="i18n.setLang('en')">EN</button>
        <button class="lang-btn" data-lang="es" onclick="i18n.setLang('es')">ES</button>
      </div>
      <nav class="header-links">
        <a href="index.html" class="header-button">Home</a>
        <a href="resources.html" class="header-button">Resources</a>
        <a href="classical_math.html" class="header-button">Math</a>
        <a href="dashboard.html" class="header-button active">Dashboard</a>
        <a href="parents-guide.html" class="header-button">Parents</a>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container">
      <h1 class="text-center mb-lg">ğŸ“Š <span data-i18n="dashboard">Dashboard</span></h1>
      
      <!-- Stats Cards -->
      <div class="stats-grid mb-lg">
        <div class="stat-card primary">
          <div class="value" id="totalTime">0</div>
          <div class="label" data-i18n="totalMinutes">Total Minutes</div>
        </div>
        <div class="stat-card success">
          <div class="value" id="totalLessons">0</div>
          <div class="label" data-i18n="lessonsCompleted">Lessons</div>
        </div>
        <div class="stat-card warning">
          <div class="value" id="currentStreak">0ğŸ”¥</div>
          <div class="label" data-i18n="dayStreak">Day Streak</div>
        </div>
      </div>

      <!-- Calendar -->
      <div class="card mb-lg">
        <div class="card-body">
          <h3 class="mb-md">ğŸ“… <span data-i18n="studyCalendar">Study Calendar</span></h3>
          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
      </div>

      <!-- Recent Sessions -->
      <div class="card mb-lg">
        <div class="card-body">
          <h3 class="mb-md">ğŸ“ <span data-i18n="recentSessions">Recent Sessions</span></h3>
          <div id="sessionList"></div>
        </div>
      </div>

      <!-- Achievements -->
      <div class="card">
        <div class="card-body">
          <h3 class="mb-md">ğŸ† <span data-i18n="achievements">Achievements</span></h3>
          <div class="stats-grid" id="achievementsGrid"></div>
        </div>
      </div>
    </div>
  </main>

  <nav class="bottom-nav">
    <a href="index.html" class="nav-item"><span class="nav-icon">ğŸ </span><span>Home</span></a>
    <a href="resources.html" class="nav-item"><span class="nav-icon">ğŸ“–</span><span>Resources</span></a>
    <a href="classical_math.html" class="nav-item"><span class="nav-icon">ğŸ”¢</span><span>Math</span></a>
    <a href="dashboard.html" class="nav-item active"><span class="nav-icon">ğŸ“Š</span><span>Dashboard</span></a>
    <a href="parents-guide.html" class="nav-item"><span class="nav-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span><span>Parents</span></a>
  </nav>

  <script src="i18n.js"></script>
  <script>
    const progress = JSON.parse(localStorage.getItem('ck_progress') || '{"sessions":[],"completed":{},"homework":[]}');
    const sessions = progress.sessions || [];
    
    // Stats
    const totalMinutes = sessions.reduce((sum, s) => sum + Math.floor((s.duration || 0) / 60), 0);
    const totalLessons = Object.keys(progress.completed || {}).length;
    
    // Streak
    const today = new Date(); today.setHours(0,0,0,0);
    const uniqueDays = [...new Set(sessions.map(s => {
      const d = new Date(s.date); d.setHours(0,0,0,0); return d.getTime();
    }))].sort((a,b) => b - a);
    
    let streak = 0;
    for (let i = 0; i < 30; i++) {
      if (uniqueDays.includes(today.getTime() - i * 86400000)) streak++;
      else if (i > 0) break;
    }
    
    document.getElementById('totalTime').textContent = totalMinutes;
    document.getElementById('totalLessons').textContent = totalLessons;
    document.getElementById('currentStreak').textContent = streak + 'ğŸ”¥';
    
    // Calendar
    const cal = document.getElementById('calendarGrid');
    const days = ['S','M','T','W','T','F','S'];
    days.forEach(d => { const el = document.createElement('div'); el.className = 'calendar-day header'; el.textContent = d; cal.appendChild(el); });
    
    const now = new Date();
    const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
    const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
    
    for (let i = 0; i < firstDay.getDay(); i++) { const el = document.createElement('div'); el.className = 'calendar-day'; cal.appendChild(el); }
    
    for (let day = 1; day <= daysInMonth; day++) {
      const el = document.createElement('div');
      el.className = 'calendar-day';
      el.textContent = day;
      const date = new Date(now.getFullYear(), now.getMonth(), day); date.setHours(0,0,0,0);
      if (uniqueDays.includes(date.getTime())) el.classList.add('completed');
      if (day === now.getDate()) el.classList.add('today');
      cal.appendChild(el);
    }
    
    // Sessions
    const sessionList = document.getElementById('sessionList');
    if (sessions.length === 0) {
      sessionList.innerHTML = '<p class="text-muted text-center">No sessions yet. Start studying!</p>';
    } else {
      const icons = {history:'ğŸ“œ',science:'ğŸ”¬',geography:'ğŸŒ',math:'ğŸ”¢',english:'ğŸ“',latin:'ğŸ“š',finearts:'ğŸ¨'};
      sessionList.innerHTML = sessions.slice(-10).reverse().map(s => {
        const d = new Date(s.date);
        return '<div style="display:flex;align-items:center;gap:var(--space-md);padding:var(--space-sm) 0;border-bottom:1px solid var(--border);">' +
          '<span style="font-size:1.5rem;">' + (icons[s.topic] || 'ğŸ“–') + '</span>' +
          '<div style="flex:1;"><strong>Cycle ' + s.cycle + ' â€¢ Week ' + s.week + '</strong><br><span class="text-muted" style="font-size:0.8rem;">' + d.toLocaleDateString() + '</span></div>' +
          '<span style="color:var(--secondary);font-weight:700;">' + Math.floor((s.duration||0)/60) + ' min</span></div>';
      }).join('');
    }
    
    // Achievements
    const achievements = [
      {icon:'ğŸ¯',title:'First Steps',desc:'Complete your first lesson',unlocked:totalLessons>=1},
      {icon:'ğŸ“š',title:'Bookworm',desc:'Complete 10 lessons',unlocked:totalLessons>=10},
      {icon:'ğŸ”¥',title:'On Fire',desc:'3 day streak',unlocked:streak>=3},
      {icon:'â­',title:'Rising Star',desc:'7 day streak',unlocked:streak>=7},
      {icon:'ğŸ†',title:'Champion',desc:'14 day streak',unlocked:streak>=14},
      {icon:'ğŸ‘‘',title:'Master',desc:'Complete a full week',unlocked:Object.keys(progress.completed||{}).filter(k=>k.split('-')[2]).length>=7}
    ];
    
    document.getElementById('achievementsGrid').innerHTML = achievements.map(a => 
      '<div class="stat-card" style="opacity:' + (a.unlocked ? '1' : '0.4') + ';">' +
      '<div class="value">' + (a.unlocked ? a.icon : 'ğŸ”’') + '</div>' +
      '<div class="label">' + a.title + '</div>' +
      '<div style="font-size:0.7rem;color:var(--text-muted);">' + a.desc + '</div></div>'
    ).join('');
  </script>
</body>
</html>
