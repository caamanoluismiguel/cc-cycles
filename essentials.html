<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#9B5DE5">
  <title>Essentials - Classical Kids Study Hub</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>">
  <link rel="stylesheet" href="styles.css">
  <style>
    :root { --ess: #9B5DE5; --ess-dark: #6930C3; --ess-light: #C77DFF; --ess-bg: #E0AAFF; }
    .ess-hero { background: linear-gradient(135deg, var(--ess), var(--ess-dark)); border-radius: var(--radius-xl); padding: var(--space-2xl); text-align: center; color: white; margin-bottom: var(--space-xl); position: relative; overflow: hidden; }
    .ess-hero h1, .ess-hero p { color: white; position: relative; z-index: 1; }
    .ess-hero::before { content: 'S V OD OI'; position: absolute; font-family: var(--font-display); font-size: 8rem; opacity: 0.06; white-space: nowrap; animation: scroll 30s linear infinite; top: 50%; transform: translateY(-50%); }
    @keyframes scroll { 0% { transform: translateY(-50%) translateX(0); } 100% { transform: translateY(-50%) translateX(-50%); } }
    
    .mode-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: var(--space-md); margin-bottom: var(--space-xl); }
    .mode-card { background: var(--warm-white); border-radius: var(--radius-xl); padding: var(--space-lg); text-align: center; cursor: pointer; transition: all 0.3s ease; border: 3px solid transparent; }
    .mode-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); border-color: var(--ess); }
    .mode-card:focus { outline: 3px solid var(--ess); outline-offset: 2px; }
    .mode-icon { font-size: 2.5rem; margin-bottom: var(--space-xs); display: block; }
    .mode-title { font-family: var(--font-display); font-size: 0.95rem; font-weight: 700; color: var(--ink); }
    .mode-desc { font-size: 0.7rem; color: var(--ink-muted); margin-top: 2px; }
    
    .tri-section { margin-bottom: var(--space-xl); }
    .tri-header { display: flex; align-items: center; gap: var(--space-md); margin-bottom: var(--space-md); padding: var(--space-md); background: linear-gradient(90deg, rgba(155,93,229,0.1), transparent); border-radius: var(--radius-lg); border-left: 4px solid var(--ess); }
    .tri-icon { font-size: 1.5rem; }
    .tri-title { font-family: var(--font-display); font-weight: 700; }
    
    .wk-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: var(--space-sm); }
    .wk-card { background: var(--warm-white); border-radius: var(--radius-lg); padding: var(--space-md); cursor: pointer; transition: all 0.3s ease; border: 2px solid var(--border); }
    .wk-card:hover { border-color: var(--ess-light); transform: translateY(-2px); box-shadow: var(--shadow-md); }
    .wk-card:focus { outline: 3px solid var(--ess); outline-offset: 2px; }
    .wk-card.done { background: linear-gradient(135deg, rgba(93,176,117,0.1), rgba(93,176,117,0.05)); border-color: var(--meadow); }
    .wk-card.done::after { content: '‚úì'; position: absolute; top: 6px; right: 6px; background: var(--meadow); color: white; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 700; }
    .wk-card { position: relative; }
    .wk-num { font-family: var(--font-display); font-size: 0.75rem; color: var(--ess); font-weight: 700; }
    .wk-topic { font-size: 0.8rem; font-weight: 600; color: var(--ink); margin-top: 2px; line-height: 1.25; }
    .wk-pat { font-size: 0.65rem; color: var(--ink-muted); margin-top: 4px; font-family: monospace; background: var(--parchment); padding: 2px 6px; border-radius: 4px; display: inline-block; }
    
    .concept-card { background: var(--warm-white); border-radius: var(--radius-lg); padding: var(--space-lg); margin-bottom: var(--space-md); border-left: 4px solid var(--ess); animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes confetti-fall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    .concept-title { font-family: var(--font-display); font-size: 1.05rem; font-weight: 700; color: var(--ess-dark); margin-bottom: var(--space-sm); display: flex; align-items: center; gap: var(--space-sm); }
    .concept-def { color: var(--ink); line-height: 1.6; margin-bottom: var(--space-sm); }
    .concept-tip { background: rgba(245,200,66,0.15); padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md); font-size: 0.85rem; margin: var(--space-sm) 0; border-left: 3px solid var(--sunshine); }
    .concept-types { margin-top: var(--space-sm); }
    .type-item { display: flex; gap: var(--space-sm); margin: var(--space-xs) 0; font-size: 0.9rem; padding: var(--space-xs) 0; border-bottom: 1px dashed var(--border); }
    .type-term { font-weight: 700; color: var(--ess); min-width: 100px; }
    .type-ex { font-style: italic; color: var(--ink-muted); }
    
    .ex-box { background: linear-gradient(135deg, rgba(155,93,229,0.08), rgba(155,93,229,0.02)); border-radius: var(--radius-md); padding: var(--space-md); margin: var(--space-md) 0; }
    
    /* Print Worksheet Styles */
    .print-btn { display: inline-flex; align-items: center; gap: var(--space-xs); }
    
    @media print {
      body { background: white !important; }
      .header, .bottom-nav, .btn-ghost, .print-btn, #practiceSection .btn, #nextBtn { display: none !important; }
      .hidden { display: block !important; }
      #printWorksheet { display: block !important; }
      .container { max-width: 100% !important; padding: 0 !important; }
      .prac-card { break-inside: avoid; page-break-inside: avoid; border: 2px solid #333 !important; margin-bottom: 20px !important; }
      .worksheet-header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 15px; }
      .worksheet-header h1 { font-size: 24px; margin: 0; }
      .worksheet-header p { margin: 5px 0 0; }
      .worksheet-q { border: 1px solid #ccc; padding: 15px; margin: 15px 0; border-radius: 8px; }
      .worksheet-q-num { font-weight: bold; }
      .worksheet-sent { font-size: 18px; margin: 10px 0; font-style: italic; }
      .worksheet-prompt { margin: 10px 0; }
      .worksheet-opts { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
      .worksheet-opt { display: flex; align-items: center; gap: 8px; }
      .worksheet-opt::before { content: '‚óã'; font-size: 18px; }
      .worksheet-line { border-bottom: 1px solid #999; height: 30px; margin: 10px 0; }
    }
    .ex-sentence { font-size: 1.15rem; font-style: italic; color: var(--ink); margin-bottom: var(--space-sm); padding: var(--space-sm); background: white; border-radius: var(--radius-sm); border-left: 3px solid var(--ess-light); }
    .ex-analysis { font-size: 0.85rem; }
    .ex-item { display: flex; gap: var(--space-sm); margin: 4px 0; }
    .ex-label { font-weight: 700; color: var(--ess); min-width: 70px; }
    .ex-exp { font-size: 0.85rem; color: var(--ink-muted); margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid var(--border); }
    
    .prac-card { background: var(--warm-white); border-radius: var(--radius-xl); padding: var(--space-xl); text-align: center; box-shadow: var(--shadow-card); margin-bottom: var(--space-lg); }
    .prac-sent { font-size: 1.4rem; font-style: italic; color: var(--ink); padding: var(--space-lg); background: var(--parchment); border-radius: var(--radius-lg); margin-bottom: var(--space-lg); line-height: 1.5; }
    .prac-q { font-family: var(--font-display); font-size: 1.1rem; color: var(--ink); margin-bottom: var(--space-lg); }
    .opts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-sm); max-width: 400px; margin: 0 auto var(--space-lg); }
    .opt-btn { padding: var(--space-md); background: var(--parchment); border: 2px solid var(--border); border-radius: var(--radius-lg); font-size: 0.95rem; font-weight: 600; color: var(--ink); cursor: pointer; transition: all 0.3s ease; }
    .opt-btn:hover { border-color: var(--ess-light); background: white; }
    .opt-btn.correct { background: rgba(93,176,117,0.2); border-color: var(--meadow); color: var(--meadow-dark); }
    .opt-btn.wrong { background: rgba(242,132,130,0.2); border-color: var(--coral); color: #c0392b; }
    
    .stats-bar { display: flex; justify-content: space-around; background: linear-gradient(135deg, var(--ess), var(--ess-dark)); padding: var(--space-lg); border-radius: var(--radius-xl); margin-bottom: var(--space-lg); color: white; }
    .stat-item { text-align: center; }
    .stat-val { font-family: var(--font-display); font-size: 1.8rem; font-weight: 800; }
    .stat-lbl { font-size: 0.7rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.05em; }
    
    .lesson-tabs { display: flex; gap: var(--space-xs); flex-wrap: wrap; margin-bottom: var(--space-lg); }
    .lesson-tab { padding: var(--space-xs) var(--space-md); background: var(--parchment); border: 2px solid var(--border); border-radius: var(--radius-full); font-size: 0.8rem; font-weight: 600; color: var(--ink-muted); cursor: pointer; transition: all 0.3s ease; }
    .lesson-tab:hover { border-color: var(--ess-light); color: var(--ink); }
    .lesson-tab.active { background: var(--ess); border-color: var(--ess); color: white; }
    
    .feedback { font-size: 1.1rem; font-weight: 700; min-height: 30px; margin-bottom: var(--space-md); }
    .feedback.correct { color: var(--meadow); }
    .feedback.wrong { color: var(--coral); }
    
    .q-labels { font-size: 0.8rem; color: var(--ink-muted); margin-bottom: var(--space-sm); }
    .q-labels strong { color: var(--ess); }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo"><div class="logo-icon">üìö</div><span>Classical Kids</span></a>
      <div class="lang-toggle">
        <button class="lang-btn" data-lang="en" onclick="setLang('en')">EN</button>
        <button class="lang-btn active" data-lang="es" onclick="setLang('es')">ES</button>
      </div>
      <nav class="header-nav">
        <a href="index.html" class="nav-link"><span class="nav-link-icon">üè†</span> Inicio</a>
        <a href="essentials.html" class="nav-link active"><span class="nav-link-icon">üìù</span> Essentials</a>
        <a href="classical_math.html" class="nav-link"><span class="nav-link-icon">üî¢</span> Math</a>
        <a href="dashboard.html" class="nav-link"><span class="nav-link-icon">üìä</span> Progreso</a>
      </nav>
    </div>
  </header>

  <main class="main">
    <div class="container">
      
      <!-- MENU -->
      <section id="menuSection">
        <div class="ess-hero">
          <h1>üìù Essentials</h1>
          <p>Gram√°tica y An√°lisis de Oraciones</p>
        </div>
        
        <div class="stats-bar">
          <div class="stat-item"><div class="stat-val" id="statWeek">1</div><div class="stat-lbl">Semana Actual</div></div>
          <div class="stat-item"><div class="stat-val" id="statDone">0</div><div class="stat-lbl">Completadas</div></div>
          <div class="stat-item"><div class="stat-val" id="statStreak">0</div><div class="stat-lbl">üî• Racha</div></div>
        </div>
        
        <h3 class="section-title">üéØ ¬øQu√© quieres hacer?</h3>
        <div class="mode-grid">
          <div class="mode-card" onclick="showLessons()"><span class="mode-icon">üìñ</span><div class="mode-title">Aprender</div><div class="mode-desc">Lecciones semanales</div></div>
          <div class="mode-card" onclick="startWeekPractice()"><span class="mode-icon">üéØ</span><div class="mode-title">Practicar Semana</div><div class="mode-desc">Ejercicios de tu semana</div></div>
          <div class="mode-card" onclick="showQuickRef()"><span class="mode-icon">üìã</span><div class="mode-title">Referencia</div><div class="mode-desc">Gu√≠a r√°pida</div></div>
        </div>
      </section>

      <!-- LESSONS LIST -->
      <section id="lessonsSection" class="hidden">
        <button class="btn btn-ghost mb-lg" onclick="showMenu()">‚Üê Men√∫</button>
        <h2 class="section-title">üìö Selecciona una Semana</h2>
        
        <div class="tri-section">
          <div class="tri-header"><span class="tri-icon">üå±</span><div><div class="tri-title">Trimestre 1: Fundamentos</div><div class="text-muted" style="font-size:0.75rem;">Semanas 1-6</div></div></div>
          <div class="wk-cards" id="wks1"></div>
        </div>
        <div class="tri-section">
          <div class="tri-header"><span class="tri-icon">üåø</span><div><div class="tri-title">Trimestre 2: Desarrollo</div><div class="text-muted" style="font-size:0.75rem;">Semanas 7-12</div></div></div>
          <div class="wk-cards" id="wks2"></div>
        </div>
        <div class="tri-section">
          <div class="tri-header"><span class="tri-icon">üå≥</span><div><div class="tri-title">Trimestre 3: Complejidad</div><div class="text-muted" style="font-size:0.75rem;">Semanas 13-18</div></div></div>
          <div class="wk-cards" id="wks3"></div>
        </div>
        <div class="tri-section">
          <div class="tri-header"><span class="tri-icon">üèÜ</span><div><div class="tri-title">Trimestre 4: Maestr√≠a</div><div class="text-muted" style="font-size:0.75rem;">Semanas 19-24</div></div></div>
          <div class="wk-cards" id="wks4"></div>
        </div>
      </section>

      <!-- LESSON DETAIL -->
      <section id="lessonDetail" class="hidden">
        <button class="btn btn-ghost mb-lg" onclick="showLessons()">‚Üê Semanas</button>
        
        <div class="card card-body-lg">
          <div style="color:var(--ess);font-weight:700;font-size:0.85rem;" id="lessonWeekNum">Semana 1</div>
          <h2 id="lessonTitle" style="margin-bottom:var(--space-xs);"></h2>
          <p class="text-muted" id="lessonSubtitle" style="margin-bottom:var(--space-lg);"></p>
          
          <div class="lesson-tabs" id="lessonTabs"></div>
          <div id="lessonContent"></div>
          
          <div class="mt-xl" style="display:flex;gap:var(--space-md);flex-wrap:wrap;">
            <button class="btn btn-ghost" onclick="prevWeek()">‚Üê Anterior</button>
            <button class="btn btn-primary" onclick="practiceThisWeek()" style="flex:1;">Practicar Esta Semana üéØ</button>
            <button class="btn btn-ghost print-btn" onclick="printWorksheet()">üñ®Ô∏è Imprimir</button>
            <button class="btn btn-ghost" onclick="nextWeek()">Siguiente ‚Üí</button>
          </div>
        </div>
      </section>

      <!-- PRACTICE -->
      <section id="practiceSection" class="hidden">
        <button class="btn btn-ghost mb-lg" onclick="exitPractice()">‚Üê Salir</button>
        
        <div class="stats-bar" style="margin-bottom:var(--space-lg);">
          <div class="stat-item"><div class="stat-val" id="pScore">0</div><div class="stat-lbl">Correctas</div></div>
          <div class="stat-item"><div class="stat-val" id="pTotal">0</div><div class="stat-lbl">de <span id="pMax">10</span></div></div>
          <div class="stat-item"><div class="stat-val" id="pStreak">0</div><div class="stat-lbl">üî• Racha</div></div>
        </div>
        
        <div class="prac-card">
          <div class="q-labels">Semana <strong id="pWeekNum">1</strong> ¬∑ Pregunta <strong id="pQNum">1</strong></div>
          <div class="prac-sent" id="pSentence">"El gato duerme."</div>
          <div class="prac-q" id="pQuestion">¬øCu√°l es el SUJETO?</div>
          <div class="opts-grid" id="pOptions"></div>
          <div class="feedback" id="pFeedback"></div>
        </div>
        
        <div class="text-center">
          <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="display:none;">Siguiente ‚Üí</button>
        </div>
      </section>

      <!-- QUICK REF -->
      <section id="quickRefSection" class="hidden">
        <button class="btn btn-ghost mb-lg" onclick="showMenu()">‚Üê Men√∫</button>
        <h2 class="section-title">üìã Gu√≠a R√°pida</h2>
        
        <div class="concept-card">
          <div class="concept-title">üìä Los 7 Patrones</div>
          <div class="concept-types">
            <div class="type-item"><span class="type-term">S-Vi</span><span>Verbo Intransitivo (El p√°jaro vuela)</span></div>
            <div class="type-item"><span class="type-term">S-Vt-OD</span><span>Verbo Transitivo + Objeto Directo (Juan come pizza)</span></div>
            <div class="type-item"><span class="type-term">S-Vt-OD-OI</span><span>+ Objeto Indirecto (Doy flores a Mar√≠a)</span></div>
            <div class="type-item"><span class="type-term">S-Vc-A</span><span>Verbo Copulativo + Atributo (El cielo es azul)</span></div>
            <div class="type-item"><span class="type-term">S-Vprep-OR√©g</span><span>Verbo Prepositivo (Pienso en ti)</span></div>
            <div class="type-item"><span class="type-term">S-Vp-CPS</span><span>Predicativo del Sujeto (Lleg√≥ cansado)</span></div>
            <div class="type-item"><span class="type-term">S-Vp-OD-CPO</span><span>Predicativo del Objeto (Considero v√°lida tu idea)</span></div>
          </div>
        </div>
        
        <div class="concept-card">
          <div class="concept-title">üéØ Los 6 Prop√≥sitos</div>
          <div class="concept-types">
            <div class="type-item"><span class="type-term">Declarativo</span><span>Afirma un hecho (El sol brilla)</span></div>
            <div class="type-item"><span class="type-term">Interrogativo</span><span>Pregunta (¬øD√≥nde est√°?)</span></div>
            <div class="type-item"><span class="type-term">Exclamativo</span><span>Emoci√≥n fuerte (¬°Qu√© lindo!)</span></div>
            <div class="type-item"><span class="type-term">Imperativo</span><span>Orden (Cierra la puerta)</span></div>
            <div class="type-item"><span class="type-term">Desiderativo</span><span>Deseo (Ojal√° llueva)</span></div>
            <div class="type-item"><span class="type-term">Dubitativo</span><span>Duda (Quiz√°s venga)</span></div>
          </div>
        </div>
        
        <div class="concept-card">
          <div class="concept-title">üèóÔ∏è Estructuras</div>
          <div class="concept-types">
            <div class="type-item"><span class="type-term">Simple</span><span>Un solo S + V</span></div>
            <div class="type-item"><span class="type-term">Coordinada</span><span>Dos cl√°usulas unidas por y, o, pero</span></div>
            <div class="type-item"><span class="type-term">Subordinada</span><span>Una depende de otra (que, cuando, porque)</span></div>
            <div class="type-item"><span class="type-term">Compleja</span><span>Coordinaci√≥n + Subordinaci√≥n juntas</span></div>
          </div>
        </div>
        
        <div class="concept-card">
          <div class="concept-title">üìù Formas No Personales</div>
          <div class="concept-types">
            <div class="type-item"><span class="type-term">Infinitivo</span><span>-ar, -er, -ir (puede ser sujeto u OD)</span></div>
            <div class="type-item"><span class="type-term">Participio</span><span>-ado, -ido (tiempos compuestos o adjetivo)</span></div>
            <div class="type-item"><span class="type-term">Gerundio</span><span>-ando, -iendo (acci√≥n en desarrollo, adverbio)</span></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <nav class="bottom-nav">
    <div class="bottom-nav-inner">
      <a href="index.html" class="bottom-nav-item"><span class="bottom-nav-icon">üè†</span><span>Inicio</span></a>
      <a href="essentials.html" class="bottom-nav-item active"><span class="bottom-nav-icon">üìù</span><span>Essentials</span></a>
      <a href="classical_math.html" class="bottom-nav-item"><span class="bottom-nav-icon">üî¢</span><span>Math</span></a>
      <a href="dashboard.html" class="bottom-nav-item"><span class="bottom-nav-icon">üìä</span><span>Progreso</span></a>
    </div>
  </nav>

  <script src="essentials-data.js"></script>
  <script>
  // Language toggle
  window.setLang = function(lang) {
    localStorage.setItem('ck_lang', lang);
    document.querySelectorAll('.lang-btn').forEach(function(btn) {
      btn.classList.toggle('active', btn.dataset.lang === lang);
    });
  };
  (function() {
    var lang = localStorage.getItem('ck_lang') || 'es'; // Default Spanish for Essentials
    document.querySelectorAll('.lang-btn').forEach(function(btn) {
      btn.classList.toggle('active', btn.dataset.lang === lang);
    });
  })();
  
  var currentWeek = 1;
  var pScore = 0, pTotal = 0, pStreak = 0, pQuestions = [], pIndex = 0;
  
  // Question type labels - ALL topics
  var qLabels = {
    // Week 1
    subject: '¬øCu√°l es el SUJETO?',
    predicate: '¬øCu√°l es el PREDICADO?',
    structure: '¬øQu√© ESTRUCTURA tiene esta oraci√≥n?',
    purpose: '¬øCu√°l es el PROP√ìSITO de esta oraci√≥n?',
    // Week 2
    verb: '¬øCu√°l es el VERBO?',
    verbType: '¬øQu√© tipo de VERBO es?',
    tense: '¬øEn qu√© TIEMPO est√° el verbo?',
    verbAction: '¬øEl verbo indica ACCI√ìN, ESTADO o PROCESO?',
    // Week 3
    pattern: '¬øCu√°l es el PATR√ìN de esta oraci√≥n?',
    article: '¬øEl art√≠culo es DEFINIDO o INDEFINIDO?',
    nounType: '¬øQu√© tipo de SUSTANTIVO es?',
    // Week 4
    subjectType: '¬øEl sujeto es SUSTANTIVO o PRONOMBRE?',
    pronoun: '¬øCu√°l es el PRONOMBRE?',
    // Week 5-6
    directObject: '¬øCu√°l es el OBJETO DIRECTO (OD)?',
    adverb: '¬øCu√°l es el ADVERBIO?',
    adverbType: '¬øQu√© tipo de ADVERBIO es?',
    // Week 7
    attribute: '¬øCu√°l es el ATRIBUTO?',
    copVerb: '¬øQu√© VERBO COPULATIVO es (SER/ESTAR/PARECER)?',
    // Week 8
    conjunction: '¬øCu√°l es la CONJUNCI√ìN?',
    conjunctionType: '¬øQu√© tipo de CONJUNCI√ìN es?',
    clauseCount: '¬øCu√°ntas CL√ÅUSULAS INDEPENDIENTES hay?',
    // Week 9
    indirectObject: '¬øCu√°l es el OBJETO INDIRECTO (OI)?',
    preposition: '¬øCu√°l es la PREPOSICI√ìN?',
    interjection: '¬øCu√°l es la INTERJECCI√ìN?',
    whatIsElLibro: '¬ø"el libro" es OD u OI?',
    whatIsAJuan: '¬ø"a Juan" es OD u OI?',
    // Week 10
    pronounOI: '¬øCu√°l es el PRONOMBRE de OI?',
    // Week 11
    regimenObject: '¬øCu√°l es el OBJETO DE R√âGIMEN?',
    prepVerb: '¬øCu√°l es la combinaci√≥n verbo + preposici√≥n?',
    conjugation: '¬øA qu√© CONJUGACI√ìN pertenece (-ar/-er/-ir)?',
    // Week 12
    mode: '¬øEn qu√© MODO est√° (Indicativo/Subjuntivo)?',
    modeOfEstudies: '¬øEn qu√© modo est√° "estudies"?',
    subjunctiveVerb: '¬øCu√°l verbo est√° en SUBJUNTIVO?',
    // Week 13
    cps: '¬øCu√°l es el CPS (Complemento Predicativo del Sujeto)?',
    mainClause: '¬øCu√°l es la CL√ÅUSULA PRINCIPAL?',
    subordinateClause: '¬øCu√°l es la CL√ÅUSULA SUBORDINADA?',
    nexus: '¬øCu√°l es el NEXO subordinante?',
    // Week 14
    voice: '¬øEn qu√© VOZ est√° (Activa/Pasiva)?',
    agent: '¬øCu√°l es el AGENTE?',
    participle: '¬øCu√°l es el PARTICIPIO?',
    whatBecomesSubjectInPassive: '¬øQu√© se vuelve SUJETO en pasiva?',
    // Week 15-16
    cpo: '¬øCu√°l es el CPO (Complemento Predicativo del Objeto)?',
    predicativeType: '¬øEs CPS, CPO o Atributo?',
    // Week 17
    subordinateType: '¬øQu√© tipo de SUBORDINADA es?',
    voiceMainClause: '¬øEn qu√© voz est√° la cl√°usula principal?',
    // Week 19
    adjectiveClause: '¬øCu√°l es la CL√ÅUSULA ADJETIVA?',
    antecedent: '¬øCu√°l es el ANTECEDENTE?',
    relativePronoun: '¬øCu√°l es el PRONOMBRE RELATIVO?',
    hasAdjectiveClause: '¬øTiene CL√ÅUSULA ADJETIVA?',
    // Week 21
    coordinatingConj: '¬øCu√°l es la CONJUNCI√ìN COORDINANTE?',
    subordinatingNexus: '¬øCu√°l es el NEXO SUBORDINANTE?',
    // Week 21-23
    verbForm: '¬øEs INFINITIVO, PARTICIPIO o GERUNDIO?',
    participleFunction: '¬øEl participio funciona como TIEMPO COMPUESTO o ADJETIVO?',
    gerundFunction: '¬øC√≥mo funciona el GERUNDIO?',
    hasGerund: '¬øTiene GERUNDIO?',
    infinitiveFunction: '¬øEl infinitivo funciona como SUJETO u OBJETO DIRECTO?'
  };
  
  document.addEventListener('DOMContentLoaded', function() {
    loadState();
    buildWeekCards();
    updateStats();
  });
  
  function loadState() {
    var saved = localStorage.getItem('ess_state');
    if (saved) {
      var s = JSON.parse(saved);
      currentWeek = s.week || 1;
    }
  }
  
  function saveState() {
    localStorage.setItem('ess_state', JSON.stringify({ week: currentWeek }));
  }
  
  function updateStats() {
    document.getElementById('statWeek').textContent = currentWeek;
    var done = JSON.parse(localStorage.getItem('ess_done') || '[]');
    document.getElementById('statDone').textContent = done.length;
    document.getElementById('statStreak').textContent = localStorage.getItem('ess_streak') || 0;
  }
  
  function buildWeekCards() {
    var done = JSON.parse(localStorage.getItem('ess_done') || '[]');
    for (var i = 1; i <= 24; i++) {
      var w = ESSENTIALS_DATA[i];
      if (!w) continue;
      var container = i <= 6 ? 'wks1' : i <= 12 ? 'wks2' : i <= 18 ? 'wks3' : 'wks4';
      var card = document.createElement('div');
      card.className = 'wk-card' + (done.includes(i) ? ' done' : '');
      card.onclick = (function(n) { return function() { showWeekDetail(n); }; })(i);
      card.innerHTML = '<div class="wk-num">Semana ' + i + '</div><div class="wk-topic">' + w.title.split(':')[0].split('(')[0].trim() + '</div><div class="wk-pat">' + w.pattern + '</div>';
      document.getElementById(container).appendChild(card);
    }
  }
  
  function showMenu() {
    document.querySelectorAll('section').forEach(function(s) { s.classList.add('hidden'); });
    document.getElementById('menuSection').classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  
  function showLessons() {
    document.querySelectorAll('section').forEach(function(s) { s.classList.add('hidden'); });
    document.getElementById('lessonsSection').classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  
  function showQuickRef() {
    document.querySelectorAll('section').forEach(function(s) { s.classList.add('hidden'); });
    document.getElementById('quickRefSection').classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  
  function showWeekDetail(num) {
    currentWeek = num;
    saveState();
    var w = ESSENTIALS_DATA[num];
    if (!w) return;
    
    document.getElementById('lessonWeekNum').textContent = 'Semana ' + num;
    document.getElementById('lessonTitle').textContent = w.title;
    document.getElementById('lessonSubtitle').textContent = w.subtitle || '';
    
    // Build tabs
    var tabs = document.getElementById('lessonTabs');
    tabs.innerHTML = '';
    var sections = ['Conceptos', 'Ejemplos'];
    sections.forEach(function(sec, i) {
      var tab = document.createElement('button');
      tab.className = 'lesson-tab' + (i === 0 ? ' active' : '');
      tab.textContent = sec;
      tab.onclick = function() {
        document.querySelectorAll('.lesson-tab').forEach(function(t) { t.classList.remove('active'); });
        tab.classList.add('active');
        renderLessonContent(w, sec.toLowerCase());
      };
      tabs.appendChild(tab);
    });
    
    renderLessonContent(w, 'conceptos');
    
    document.querySelectorAll('section').forEach(function(s) { s.classList.add('hidden'); });
    document.getElementById('lessonDetail').classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  
  function renderLessonContent(w, section) {
    var content = document.getElementById('lessonContent');
    var html = '';
    
    if (section === 'conceptos' && w.concepts) {
      w.concepts.forEach(function(c) {
        html += '<div class="concept-card">';
        html += '<div class="concept-title">' + (c.icon || 'üìå') + ' ' + c.name + '</div>';
        html += '<div class="concept-def">' + c.definition + '</div>';
        if (c.tip) html += '<div class="concept-tip">üí° ' + c.tip + '</div>';
        if (c.types) {
          html += '<div class="concept-types">';
          c.types.forEach(function(t) {
            html += '<div class="type-item"><span class="type-term">' + t.term + '</span><span>' + (t.desc || '') + (t.example ? ' <span class="type-ex">' + t.example + '</span>' : '') + '</span></div>';
          });
          html += '</div>';
        }
        if (c.example && c.example.sentence) {
          html += '<div class="ex-box"><div class="ex-sentence">"' + c.example.sentence + '"</div>';
          if (c.example.question) html += '<div class="ex-item"><span class="ex-label">Pregunta:</span><span>' + c.example.question + '</span></div>';
          if (c.example.answer) html += '<div class="ex-item"><span class="ex-label">Respuesta:</span><span>' + c.example.answer + '</span></div>';
          if (c.example.explanation) html += '<div class="ex-exp">' + c.example.explanation + '</div>';
          html += '</div>';
        }
        html += '</div>';
      });
    } else if (section === 'ejemplos' && w.examples) {
      w.examples.forEach(function(ex) {
        html += '<div class="ex-box">';
        html += '<div class="ex-sentence">"' + ex.sentence + '"</div>';
        html += '<div class="ex-analysis">';
        if (ex.analysis) {
          Object.keys(ex.analysis).forEach(function(key) {
            var label = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1');
            html += '<div class="ex-item"><span class="ex-label">' + label + ':</span><span>' + ex.analysis[key] + '</span></div>';
          });
        }
        html += '</div>';
        if (ex.explanation) html += '<div class="ex-exp">üìù ' + ex.explanation + '</div>';
        if (ex.breakdown) {
          html += '<div style="margin-top:var(--space-sm);"><strong>Desglose:</strong>';
          ex.breakdown.forEach(function(b) {
            html += '<div class="ex-item"><span class="ex-label">"' + b.word + '"</span><span>' + b.role + '</span></div>';
          });
          html += '</div>';
        }
        html += '</div>';
      });
    }
    
    content.innerHTML = html || '<p class="text-muted">No hay contenido disponible.</p>';
  }
  
  function prevWeek() { if (currentWeek > 1) showWeekDetail(currentWeek - 1); }
  function nextWeek() { if (currentWeek < 24) showWeekDetail(currentWeek + 1); }
  
  function practiceThisWeek() { startPractice(currentWeek); }
  function startWeekPractice() { startPractice(currentWeek); }
  
  function startPractice(week) {
    currentWeek = week;
    var w = ESSENTIALS_DATA[week];
    if (!w || !w.practice) { alert('No hay ejercicios para esta semana.'); return; }
    
    pScore = 0; pTotal = 0; pStreak = 0; pIndex = 0;
    pQuestions = shuffle(w.practice.slice());
    
    document.getElementById('pWeekNum').textContent = week;
    document.getElementById('pMax').textContent = pQuestions.length;
    
    document.querySelectorAll('section').forEach(function(s) { s.classList.add('hidden'); });
    document.getElementById('practiceSection').classList.remove('hidden');
    
    loadQuestion();
  }
  
  function loadQuestion() {
    if (pIndex >= pQuestions.length) { endPractice(); return; }
    
    var q = pQuestions[pIndex];
    document.getElementById('pQNum').textContent = pIndex + 1;
    document.getElementById('pSentence').textContent = '"' + q.sentence + '"';
    document.getElementById('pQuestion').textContent = qLabels[q.q] || '¬ø' + q.q + '?';
    document.getElementById('pFeedback').textContent = '';
    document.getElementById('pFeedback').className = 'feedback';
    document.getElementById('nextBtn').style.display = 'none';
    
    var opts = document.getElementById('pOptions');
    opts.innerHTML = '';
    shuffle(q.options.slice()).forEach(function(opt) {
      var btn = document.createElement('button');
      btn.className = 'opt-btn';
      btn.textContent = opt;
      btn.onclick = function() { checkAnswer(opt, q.correct, btn); };
      opts.appendChild(btn);
    });
    
    updatePracticeStats();
  }
  
  function checkAnswer(selected, correct, btn) {
    pTotal++;
    document.querySelectorAll('.opt-btn').forEach(function(b) {
      b.onclick = null;
      if (b.textContent === correct) b.classList.add('correct');
    });
    
    var fb = document.getElementById('pFeedback');
    if (selected === correct) {
      pScore++; pStreak++;
      btn.classList.add('correct');
      fb.textContent = '‚úì ¬°Correcto!';
      fb.className = 'feedback correct';
      if (pStreak % 3 === 0) confetti(25);
    } else {
      pStreak = 0;
      btn.classList.add('wrong');
      fb.textContent = '‚úó Respuesta: ' + correct;
      fb.className = 'feedback wrong';
    }
    
    updatePracticeStats();
    document.getElementById('nextBtn').style.display = 'inline-flex';
  }
  
  function nextQuestion() {
    pIndex++;
    loadQuestion();
  }
  
  function updatePracticeStats() {
    document.getElementById('pScore').textContent = pScore;
    document.getElementById('pTotal').textContent = pTotal;
    document.getElementById('pStreak').textContent = pStreak;
  }
  
  function endPractice() {
    var pct = Math.round(pScore / pQuestions.length * 100);
    var msg = pct >= 90 ? 'üèÜ ¬°Excelente!' : pct >= 70 ? '‚≠ê ¬°Muy bien!' : pct >= 50 ? 'üëç ¬°Buen esfuerzo!' : 'üí™ ¬°Sigue practicando!';
    alert(msg + '\n\nResultado: ' + pScore + '/' + pQuestions.length + ' (' + pct + '%)');
    
    if (pct >= 70) {
      var done = JSON.parse(localStorage.getItem('ess_done') || '[]');
      if (!done.includes(currentWeek)) { done.push(currentWeek); localStorage.setItem('ess_done', JSON.stringify(done)); }
    }
    
    confetti(pct >= 70 ? 80 : 30);
    showWeekDetail(currentWeek);
  }
  
  function exitPractice() {
    if (pTotal > 0 && !confirm('¬øSalir de la pr√°ctica? Perder√°s tu progreso.')) return;
    showMenu();
  }
  
  function shuffle(arr) {
    for (var i = arr.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var t = arr[i]; arr[i] = arr[j]; arr[j] = t;
    }
    return arr;
  }
  
  function confetti(n) {
    var colors = ['#9B5DE5','#5DB075','#F5C842','#E8845F','#4A90D9','#F28482'];
    for (var i = 0; i < n; i++) {
      var c = document.createElement('div');
      c.style.cssText = 'position:fixed;width:' + (6+Math.random()*8) + 'px;height:' + (6+Math.random()*8) + 'px;top:-10px;left:' + Math.random()*100 + 'vw;background:' + colors[Math.floor(Math.random()*6)] + ';z-index:9999;pointer-events:none;border-radius:' + (Math.random()>.5?'50%':'2px') + ';animation:confetti-fall ' + (2+Math.random()*2) + 's linear forwards;';
      document.body.appendChild(c);
      setTimeout(function(el) { el.remove(); }, 4000, c);
    }
  }
  
  function printWorksheet() {
    var w = ESSENTIALS_DATA[currentWeek];
    if (!w || !w.practice) { alert('No hay ejercicios para esta semana.'); return; }
    
    // Create printable worksheet
    var printWindow = window.open('', '_blank');
    var html = '<!DOCTYPE html><html><head><title>Hoja de Pr√°ctica - Semana ' + currentWeek + '</title>';
    html += '<style>';
    html += 'body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }';
    html += '.header { text-align: center; border-bottom: 3px solid #9B5DE5; padding-bottom: 20px; margin-bottom: 30px; }';
    html += '.header h1 { margin: 0; color: #9B5DE5; }';
    html += '.header p { margin: 5px 0 0; color: #666; }';
    html += '.student-info { display: flex; gap: 40px; margin-bottom: 30px; }';
    html += '.student-info div { flex: 1; }';
    html += '.student-info label { font-weight: bold; }';
    html += '.student-info .line { border-bottom: 1px solid #333; height: 25px; margin-top: 5px; }';
    html += '.question { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 10px; page-break-inside: avoid; }';
    html += '.q-num { font-weight: bold; color: #9B5DE5; font-size: 14px; }';
    html += '.sentence { font-size: 20px; margin: 15px 0; padding: 15px; background: #f5f5f5; border-radius: 8px; text-align: center; font-style: italic; }';
    html += '.prompt { font-weight: bold; margin: 15px 0; }';
    html += '.options { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; }';
    html += '.option { display: flex; align-items: center; gap: 10px; padding: 8px 15px; border: 2px solid #ddd; border-radius: 20px; }';
    html += '.option-circle { width: 18px; height: 18px; border: 2px solid #999; border-radius: 50%; }';
    html += '.answer-line { border-bottom: 2px solid #333; height: 35px; margin: 15px 0; }';
    html += '.footer { margin-top: 40px; text-align: center; color: #999; font-size: 12px; border-top: 1px solid #ddd; padding-top: 20px; }';
    html += '@media print { .question { break-inside: avoid; } }';
    html += '</style></head><body>';
    
    // Header
    html += '<div class="header">';
    html += '<h1>üìù Essentials - Semana ' + currentWeek + '</h1>';
    html += '<p>' + w.title + '</p>';
    html += '</div>';
    
    // Student info
    html += '<div class="student-info">';
    html += '<div><label>Nombre:</label><div class="line"></div></div>';
    html += '<div><label>Fecha:</label><div class="line"></div></div>';
    html += '</div>';
    
    // Questions (limit to 10 for printing)
    var questions = w.practice.slice(0, 10);
    questions.forEach(function(q, idx) {
      html += '<div class="question">';
      html += '<div class="q-num">Pregunta ' + (idx + 1) + '</div>';
      html += '<div class="sentence">"' + q.sentence + '"</div>';
      html += '<div class="prompt">' + (qLabels[q.q] || q.q) + '</div>';
      html += '<div class="options">';
      q.options.forEach(function(opt) {
        html += '<div class="option"><div class="option-circle"></div><span>' + opt + '</span></div>';
      });
      html += '</div>';
      html += '</div>';
    });
    
    // Footer
    html += '<div class="footer">';
    html += 'üìö Classical Kids Study Hub - Essentials<br>';
    html += 'classicalkid.co';
    html += '</div>';
    
    html += '</body></html>';
    
    printWindow.document.write(html);
    printWindow.document.close();
    printWindow.onload = function() {
      printWindow.print();
    };
  }
  </script>
</body>
</html>
